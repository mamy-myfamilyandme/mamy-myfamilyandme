# .pre-commit-config.yaml
# Backend(Python/Django) + Frontend(React Native/TypeScript) í†µí•© ì„¤ì •

# =============================================================================
# ì „ì—­ ì„¤ì •
# =============================================================================

# ì œì™¸í•  íŒŒì¼/ë””ë ‰í† ë¦¬ íŒ¨í„´
exclude: |
  (?x)^(
    backend/migrations/.*|
    backend/\.venv/.*|
    backend/htmlcov/.*|
    backend/\.pytest_cache/.*|
    backend/db\.sqlite3|
    frontend/MamyApp/node_modules/.*|
    frontend/MamyApp/ios/Pods/.*|
    frontend/MamyApp/ios/build/.*|
    frontend/MamyApp/android/\.gradle/.*|
    frontend/MamyApp/android/build/.*|
    frontend/MamyApp/\.expo/.*|
    .*\.pyc|
    .*\.log|
    \.git/.*
  )$

# =============================================================================
# Hooks (ì‹¤í–‰ ìˆœì„œëŒ€ë¡œ ì •ì˜)
# =============================================================================

repos:
  # ---------------------------------------------------------------------------
  # 1. Backend - Python/Django
  # ---------------------------------------------------------------------------
  
  # Ruff - Python ë¦°íŒ… ë° í¬ë§·íŒ…
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.13.0
    hooks:
      # ë¦°íŒ… (import ì •ë ¬, ì½”ë“œ ìŠ¤íƒ€ì¼ ì²´í¬)
      - id: ruff
        name: "ğŸ Backend: Ruff ë¦°íŒ…"
        args: [--fix]  # ìë™ ìˆ˜ì • ê°€ëŠ¥í•œ ê²ƒì€ ìˆ˜ì •
        files: ^backend/.*\.py$
        exclude: ^backend/.*/migrations/.*\.py$
      
      # í¬ë§·íŒ… (Black ìŠ¤íƒ€ì¼)
      - id: ruff-format
        name: "ğŸ¨ Backend: Ruff í¬ë§·íŒ…"
        files: ^backend/.*\.py$
        exclude: ^backend/.*/migrations/.*\.py$

  # Django ì²´í¬
  # - repo: local
  #   hooks:
  #     # Django system check
  #     - id: django-check
  #       name: "ğŸ—ï¸ Backend: Django Check"
  #       entry: bash -c 'cd backend && uv run python manage.py check --deploy'
  #       language: system
  #       pass_filenames: false
  #       files: ^backend/
      
  #     # Migration ì²´í¬ (ë¯¸ì ìš© ë§ˆì´ê·¸ë ˆì´ì…˜ ê°ì§€)
  #     - id: django-migrations
  #       name: "ğŸ”„ Backend: Migration Check"
  #       entry: bash -c 'cd backend && uv run python manage.py makemigrations --check --dry-run'
  #       language: system
  #       pass_filenames: false
  #       files: ^backend/.*\.(py|json)$

  # ---------------------------------------------------------------------------
  # 2. Frontend - React Native/TypeScript
  # ---------------------------------------------------------------------------
  
  # ESLint - JavaScript/TypeScript ë¦°íŒ…
  - repo: local
    hooks:
      - id: eslint-frontend
        name: "âš›ï¸ Frontend: ESLint"
        entry: bash -c 'cd frontend/MamyApp && npx eslint --fix'
        language: system
        files: ^frontend/MamyApp/.*\.(js|jsx|ts|tsx)$
        exclude: ^frontend/MamyApp/(node_modules|ios/Pods|android/\.gradle)/
        pass_filenames: false

  # TypeScript íƒ€ì… ì²´í¬
  # - repo: local
  #   hooks:
  #     - id: typescript-check
  #       name: "ğŸ“˜ Frontend: TypeScript"
  #       entry: bash -c 'cd frontend/MamyApp && npx tsc --noEmit'
  #       language: system
  #       files: ^frontend/MamyApp/.*\.(ts|tsx)$
  #       pass_filenames: false

  # Prettier - ì½”ë“œ í¬ë§·íŒ… (ì„ íƒ ì‚¬í•­)
  # - repo: local
  #   hooks:
  #     - id: prettier-frontend
  #       name: "ğŸ’… Frontend: Prettier"
  #       entry: bash -c 'cd frontend/MamyApp && npx prettier --write'
  #       language: system
  #       files: ^frontend/MamyApp/.*\.(js|jsx|ts|tsx|json|css|md)$
  #       pass_filenames: false

  # ---------------------------------------------------------------------------
  # 3. ê³µí†µ - íŒŒì¼ í’ˆì§ˆ ì²´í¬
  # ---------------------------------------------------------------------------
  
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      # íŒŒì¼ ë ì¤„ë°”ê¿ˆ ì¶”ê°€
      - id: end-of-file-fixer
        name: "ğŸ“ íŒŒì¼ ë ì¤„ë°”ê¿ˆ"
        exclude: \.(png|jpg|jpeg|gif|svg|ico|ttf|woff|woff2)$
      
      # íŒŒì¼ ë ê³µë°± ì œê±°
      - id: trailing-whitespace
        name: "âœ‚ï¸ íŒŒì¼ ë ê³µë°± ì œê±°"
        args: [--markdown-linebreak-ext=md]
        exclude: \.(png|jpg|jpeg|gif|svg|ico)$
      
      # YAML ë¬¸ë²• ì²´í¬
      - id: check-yaml
        name: "ğŸ“‹ YAML ë¬¸ë²• ì²´í¬"
        args: [--unsafe]  # Django í…œí”Œë¦¿ íƒœê·¸ í—ˆìš©
      
      # JSON ë¬¸ë²• ì²´í¬
      - id: check-json
        name: "ğŸ”§ JSON ë¬¸ë²• ì²´í¬"
      
      # ëŒ€ìš©ëŸ‰ íŒŒì¼ ì»¤ë°‹ ë°©ì§€
      - id: check-added-large-files
        name: "ğŸ“¦ ëŒ€ìš©ëŸ‰ íŒŒì¼ ì²´í¬"
        args: [--maxkb=1000]  # 1MB ì œí•œ
      
      # Merge conflict ë§ˆì»¤ ì²´í¬
      - id: check-merge-conflict
        name: "âš ï¸ Merge Conflict ì²´í¬"
      
      # Python AST ë¬¸ë²• ì²´í¬
      - id: check-ast
        name: "ğŸ Python ë¬¸ë²• ì²´í¬"
        files: ^backend/.*\.py$

  # ---------------------------------------------------------------------------
  # 4. ë³´ì•ˆ ì²´í¬ (ì„ íƒ ì‚¬í•­ - ì¶”í›„ í™œì„±í™”)
  # ---------------------------------------------------------------------------
  
  # # Bandit - Python ë³´ì•ˆ ì·¨ì•½ì  ì²´í¬
  # - repo: https://github.com/PyCQA/bandit
  #   rev: 1.7.10
  #   hooks:
  #     - id: bandit
  #       name: "ğŸ”’ Backend: ë³´ì•ˆ ì²´í¬"
  #       args: [-ll, -i, B308,B703]
  #       files: ^backend/.*\.py$
  
  # # Detect Secrets - ì‹œí¬ë¦¿ í‚¤ ë…¸ì¶œ ë°©ì§€
  # - repo: https://github.com/Yelp/detect-secrets
  #   rev: v1.5.0
  #   hooks:
  #     - id: detect-secrets
  #       name: "ğŸ” ì‹œí¬ë¦¿ í‚¤ ì²´í¬"
  #       args: [--baseline, .secrets.baseline]

# =============================================================================
# CI ì„¤ì • (ì„ íƒ ì‚¬í•­)
# =============================================================================

ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit hooks
    
    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_branch: ''
  autoupdate_commit_msg: '[pre-commit.ci] pre-commit autoupdate'
  autoupdate_schedule: weekly
  skip: []
  submodules: false